---
layout: experiment
title: "P5JS - Ink Experiment"
---

<script src="https://cdnjs.cloudflare.com/ajax/libs/inobounce/0.2.0/inobounce.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>
<script>
"use strict";

/*
  Globals 🌎
*/

const width = window.innerWidth;
const height = window.innerHeight;
let accelerating = false;
let currentX = -999;
let currentY = -999;
let circleWidth = 100;
let maxCircleWidth = 150;
let minCircleWidth = 10;
const distances = [];
let drawCount = 0;
let r = randomRGB();
let rIncreasing = true;
let g = randomRGB();
let gIncreasing = true;
let b = randomRGB();
let bIncreasing = true;

/*
  Helpers 🛠
*/

function updateRGB() {
  const rIncrement = 1 //randomRGB();
  const gIncrement = 1 //randomRGB();
  const bIncrement = 1 //randomRGB();

  r = r + (rIncreasing ? rIncrement : -rIncrement);
  g = g + (gIncreasing ? gIncrement : -gIncrement);
  b = b + (bIncreasing ? bIncrement : -bIncrement);

  if (r >= 255) {
    rIncreasing = false;
  } else if (r <= 0) {
    rIncreasing = true;
  }
  if (g >= 255) {
    gIncreasing = false;
  } else if (r <= 0) {
    gIncreasing = true;
  }
  if (b >= 255) {
    bIncreasing = false;
  } else if (r <= 0) {
    bIncreasing = true;
  }
}

function randomRGB() {
  return Math.round(Math.random() * 256, 0);
}

function average(data){
  var sum = data.reduce(function(sum, value){
    return sum + value;
  }, 0);

  var avg = sum / data.length;
  return avg;
}

function standardDeviation(values){
  var avg = average(values);

  var squareDiffs = values.map(function(value){
    var diff = value - avg;
    var sqrDiff = diff * diff;
    return sqrDiff;
  });

  var avgSquareDiff = average(squareDiffs);

  var stdDev = Math.sqrt(avgSquareDiff);
  return stdDev;
}

function appendInfo() {
  const div = document.createElement('div');
  div.style.cssText = `
    bottom: 10px;
    opacity: 0.5;
    left: 10px;
    position: absolute;
    height: 20px;
    width: 100%;
    z-index: 100;
  `;
  div.innerHTML = '<a href="https://p5js.org/" rel="nofollow" target="_blank">Built using p5js</a>'
  document.body.appendChild(div);
}

function updateCurrentXY(x, y) {
  const lastX = currentX;
  const lastY = currentY;

  currentX = x;
  currentY = y;

  const a = Math.abs(currentX - lastX);
  const b = Math.abs(currentY - lastY);

  const distance = Math.sqrt(Math.pow(a, 2), Math.pow(b, 2));
  distances.push(distance);

  while (distances.length > 10) {
    distances.shift();
  }
}

function begin() {
  window.setInterval(() => {
    let deviation = standardDeviation(distances);
    deviation = isNaN(deviation) ? 1 : deviation;

    if (deviation > 0.5) {
      accelerating = true;
    } else {
      accelerating = false;
    }

    const incrementValue = 1 * deviation / 100;
    const increment = accelerating ? -1 : 1;
    const proposedCircleWidth = Math.abs(circleWidth + increment);

    circleWidth = proposedCircleWidth >= maxCircleWidth
      ? maxCircleWidth
      : proposedCircleWidth <= minCircleWidth
        ? minCircleWidth
        : proposedCircleWidth;

  }, 100);
}

/*
  P5 Setup 🏗 and Draw 🎨
*/

function setup() {
  createCanvas(width, height, 'p2d');
  background(246, 229, 141);
  noStroke();

  if (Modernizr.touch) {
    window.addEventListener('touchmove', (touchEvent) => {
      const [ touch ] = touchEvent.touches;
      const { pageX, pageY } = touch;
      updateCurrentXY(pageX, pageY);
    });
  } else {
    window.addEventListener('mousemove', ({x, y}) => updateCurrentXY(x,y));
  }

  appendInfo();
  begin();
}

function draw() {
  fill(r, g, b);

  updateRGB();

  circle(currentX, currentY, circleWidth);

  drawCount += 1;
}
</script>
